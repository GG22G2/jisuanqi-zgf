(function(){"use strict";self.onmessage=w=>{let c=w.data;A.setBaseData(c.data);let I=A.call(c.start,c.limit);self.postMessage({type:"r",result:I})};class G{constructor(){this.playRecipes=null,this.start=0,this.groupRecipeIndex=null,this.groupMaxScore=null,this.groupMaxScoreChefIndex=null}setBaseData({playRecipesArr:c,recipePL:I,amberPrice:o,scoreCache:M,recipeCount:n,chefCount:x}){this.playRecipes=c,this.recipePL=I;let a=this.calAllCache(M,o,n,x);this.groupMaxScore=a.groupMaxScore,this.groupMaxScoreChefIndex=a.groupMaxScoreChefIndex,this.groupRecipeIndex=a.groupRecipeIndex}call(c,I){let o=Date.now(),M=0,n=0,x,a,p,t={maxScore:0,maxScoreChefGroup:new Array(3),recipes:null,permuation:null};const e=this.playRecipes,u=Math.sqrt(this.groupRecipeIndex.length);for(let S=c;S<I;S++){const r=S*9;for(let g=0;g<1680;g++){const l=this.recipePL[g];x=this.groupRecipeIndex[e[r+l[0]]*u+e[r+l[1]]]+(e[r+l[2]]-e[r+l[1]]-1),a=this.groupRecipeIndex[e[r+l[3]]*u+e[r+l[4]]]+(e[r+l[5]]-e[r+l[4]]-1),p=this.groupRecipeIndex[e[r+l[6]]*u+e[r+l[7]]]+(e[r+l[8]]-e[r+l[7]]-1),x=x*3,a=a*3,p=p*3;let d=this.groupMaxScore[x]+this.groupMaxScore[a]+this.groupMaxScore[p];if(d>n){let f=this.groupMaxScoreChefIndex[x],s=this.groupMaxScoreChefIndex[a],i=this.groupMaxScoreChefIndex[p];if(f!==s&&f!==i&&s!==i)n=d,t.maxScore=n,t.maxScoreChefGroup=[f,s,i],t.recipes=e.slice(r,r+9),t.permuation=l;else for(let m=0;m<3;m++)for(let R=0;R<3;R++)for(let y=0;y<3;y++)d=this.groupMaxScore[x+m]+this.groupMaxScore[a+R]+this.groupMaxScore[p+y],f=this.groupMaxScoreChefIndex[x+m],s=this.groupMaxScoreChefIndex[a+R],i=this.groupMaxScoreChefIndex[p+y],d>n&&f!==s&&f!==i&&s!==i&&(n=d,t.maxScore=n,t.maxScoreChefGroup=[f,s,i],t.recipes=e.slice(r,r+9),t.permuation=l)}}}return M=Date.now(),console.info(I-c+"组数据计算用时:"+(M-o)+"ms"),t}calAllCache(c,I,o,M){let n=0;for(let t=0;t<o;t++)for(let e=t+1;e<o;e++)for(let u=e+1;u<o;u++)n++;console.log(`菜谱组合 ${n}`);const x=new Int32Array(o*o),a=new Int32Array(n*3),p=new Int32Array(n*3);let h=0;console.time("计算菜谱组合最高3个得分"),h=0;for(let t=0;t<o;t++){for(let e=t+1;e<o;e++){x[t*o+e]=h/3;for(let u=e+1;u<o;u++){let S=0,r=0,g=0,l=0,d=0,f=0;for(let s=0;s<M;s++){let i=0;c[s*o+t]===0||c[s*o+e]===0||c[s*o+u]===0||(i=c[s*o+t]+c[s*o+e]+c[s*o+u]),i>S?(g=r,f=d,r=S,d=l,S=i,l=s):i>r?(g=r,f=d,r=i,d=s):i>g&&(g=i,f=s)}p[h]=l,p[h+1]=d,p[h+2]=f,a[h]=S,a[h+1]=r,a[h+2]=g,h=h+3}}postMessage({type:"p",p:h/(n*3)})}return console.timeEnd("计算菜谱组合最高3个得分"),{groupRecipeIndex:x,groupMaxScore:a,groupMaxScoreChefIndex:p}}}let A=new G})();
